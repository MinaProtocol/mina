# PR 16820: Move kimchi-stubs into proof-systems

## Summary

Mina codebase uses a mix of Rust and OCaml code. In particular, a significant
part of the low-level cryptography resides in the repository
[proof-systems](https://github.com/o1-labs/proof-systems). To compile Mina, Rust
and OCaml code are glued together using code generated by
[ocaml-rs](https://github.com/zshipko/ocaml-rs) and
[ocaml-gen](https://github.com/o1-labs/ocaml-gen/). Part of this "glue code" for
native code generation has historically be located in the main Mina repository
under the path `src/lib/crypto/kimchi_bindings/stubs`. This glue code introduces
a binary generating some of the OCaml codebase used by Pickles
([main.rs](../src/lib/crypto/kimchi_bindings/stubs/src/main.rs)) and a
intermediary library,
[wires_15_stubs](../src/lib/crypto/kimchi_bindings/stubs/src/lib.rs), used by
the previously linked binary.

The library naturally uses code from proof-systems, in addition to external
dependencies.

Over time, this dispersed structure of the Rust codebase has created issues
with updates and dependencies management.

In addition, the engineering principles enforced in the proof-systems repository
are not always replicated in this codebase, and no continuous integration is
running for Rust code in the Mina repository.

Moreover, breaking compilation changes could occur between Mina and
proof-systems when code used by the glue in `wires_15_stubs` was updated and not
directly propagated in the Mina repository.

This patch, together with its counterpart in
[proof-systems](https://github.com/o1-labs/proof-systems/pull/3123) and in
[kimchi-stubs-vendor](https://github.com/MinaProtocol/kimchi-stubs-vendors/pull/6),
aims to simplify the Rust management codebase by gradually migrating the
relevant code into proof-systems - an approchard we have discussed at o1Labs
over the past few years.

It is a first step, and follow-up patch is on the way.

## Changes

- Move the library called `wires_15_stubs` into proof-systems, renaming it to
  `kimchi_stubs`.
- Update the Dune stanza accordingly.
- Update the Nix files accordingly.
- Introduce the generation of the shared object file for the `kimchi-stubs` library,
  instead of relying on the empty file `dllwires_15_stubs.so`. Additionally, handle
  the different operating system behaviors (macOS, UNIX, GNU/Linux) with respect
  to the naming conventions of dynamic library files. This file was used by the
  library `src/lib/o1js_stub`.

## Impact

This change aims to simplify the developer experience by centralizing dependency
management, consolidating the Rust codebase, and encouraging consistent Rust practices
across the previously scattered components now unified under a single repository.
