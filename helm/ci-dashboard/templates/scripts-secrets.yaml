{{- $root := . -}}
{{- range $i, $retriever := .Values.retrievers }}
{{- $name := $retriever.name }}
---
kind: Secret
apiVersion: v1
metadata:
  name: {{ $retriever.script.secret.name }}
  labels:
    {{- include "ci-dashboard.labels" $root | nindent 4 }}
data:
  {{- ($root.Files.Glob (printf "files/%s/%s" $name $retriever.script.name)).AsSecrets | nindent 4 }}
  {{- ($root.Files.Glob (printf "files/%s/requirements.txt" $name)).AsSecrets | nindent 4 }}
{{- end }}