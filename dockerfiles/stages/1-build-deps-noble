FROM build-deps AS build-deps-noble

# Canonical naming convention
# : aarch64/x86_64
ARG CANONICAL_ARCH

ENV DEBIAN_FRONTEND=noninteractive

USER root

RUN apt-get update --quiet \
  && apt-get upgrade --quiet --yes \
  && apt-get install --no-install-recommends --quiet --yes \
    libssl3t64 \
    libproc2-0 \
  && rm -rf /var/lib/apt/lists/*

RUN curl "https://awscli.amazonaws.com/awscli-exe-linux-${CANONICAL_ARCH}.zip" -o "awscliv2.zip" \
  && unzip awscliv2.zip \
  && ./aws/install \
  && rm -rf awscliv2.zip aws

USER opam