(rule
 (alias precomputed_block)
 (targets
  hetzner-itn-1-296991.json
  hetzner-itn-1-296998.json)
 (deps
  (env_var TEST_PRECOMPUTED_BLOCK_JSON_PATH))
 (enabled_if
  (= %{env:TEST_PRECOMPUTED_BLOCK_JSON_PATH=n} n))
 (action
  (progn
   (run
    curl
    -L
    -o
    hetzner-itn-1-296991.json.gz
    https://storage.googleapis.com/o1labs-ci-test-data/precomputed-blocks/hetzner-itn-1-296991-3NLfjbkNF3AK46qnLwzQj3F6mYikxpnmBbX4HqWhShf84jCdXLT3.json.gz)
   (run
    curl
    -L
    -o
    hetzner-itn-1-296998.json.gz
    https://storage.googleapis.com/o1labs-ci-test-data/precomputed-blocks/hetzner-itn-1-296998-3NLeYDjJNM6Q2eD7HWfbL1t9nQt36BHQYi4WwVLry4HqrKccwqJ6.json.gz)
   (run gzip -d hetzner-itn-1-296991.json.gz)
   (run gzip -d hetzner-itn-1-296998.json.gz))))

(rule
 (enabled_if
  (<> %{env:TEST_PRECOMPUTED_BLOCK_JSON_PATH=n} n))
 (targets
  hetzner-itn-1-296991.json
  hetzner-itn-1-296998.json)
 (deps
  (env_var TEST_PRECOMPUTED_BLOCK_JSON_PATH))
 (action
  (progn
   (copy %{env:TEST_PRECOMPUTED_BLOCK_JSON_PATH=n} hetzner-itn-1-296991.json)
   (copy %{env:TEST_PRECOMPUTED_BLOCK_JSON_PATH=n} hetzner-itn-1-296998.json))))

(test
 (name main)
 (libraries alcotest async core_kernel disk_cache.lmdb mina_block yojson)
 (deps
  hetzner-itn-1-296991.json
  hetzner-itn-1-296998.json
  regtest-devnet-319281-3NKq8WXEzMFJH3VdmK4seCTpciyjSY2Rf39K7q1Yyt1p4HkqSzqA.json)
 (instrumentation
  (backend bisect_ppx))
 (preprocess
  (pps ppx_jane ppx_version)))
