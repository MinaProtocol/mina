(library
 (name test_cache_deadlock_lib)
 (modules test_cache_deadlock)
 (libraries
  ;; opam libraries
  async
  core
  core_kernel
  ;; local libraries
  disk_cache_intf
  file_system
  logger)
 (instrumentation
  (backend bisect_ppx))
 (preprocess
  (pps ppx_jane ppx_version))
 ;; Ignoring -22 because we use Binable.of_binable_without_uuid
 (flags
  (:standard -w +a -w -22)))

(test
 (name test_lmdb_deadlock)
 (modules test_lmdb_deadlock)
 (libraries
  ;; opam libraries
  async
  ;; local libraries
  disk_cache.lmdb
  test_cache_deadlock_lib)
 (instrumentation
  (backend bisect_ppx))
 (preprocess
  (pps ppx_jane ppx_version))
 (flags
  (:standard -w +a)))

(test
 (name test_filesystem_deadlock)
 (modules test_filesystem_deadlock)
 (libraries
  ;; opam libraries
  async
  ;; local libraries
  disk_cache.filesystem
  test_cache_deadlock_lib)
 (instrumentation
  (backend bisect_ppx))
 (preprocess
  (pps ppx_jane ppx_version))
 (flags
  (:standard -w +a)))
